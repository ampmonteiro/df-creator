//By Agostinho Monteiro
// Updated: 4/11/2016
// v1
//app developed with:
  //jQuery - http://jquery.com
  //twitter-bootstrap - http://getbootstrap.com
  // jsPDF -  https://github.com/MrRio/jsPDF |  https://mrrio.github.io
  // jsPDF Plugin: autoTable - https://github.com/simonbengtsson/jsPDF-AutoTable


function edit_info(){$("#pers tr:eq(1) td:eq(1)").text($("#i_name").val()),$("#pers tr:eq(2) td:eq(1)").text($("#i_country").val()),$("#pers tr:eq(3) td:eq(1)").text($("#i_email").val()),$("#pers tr:eq(4) td:eq(1)").text($("#i_deg").val()),$("#pers tr:eq(5) td:eq(1)").text($("#i_pos").val()),$("#pers tr:eq(6) td:eq(1)").text($("#i_pro").val())}function edit_tech(){var a="Level: <span class='lv'>"+$("#sel_level").val()+"</span>",b=" |     Years: <span class='years'>"+$("#i_years").val()+"</span>";$("#"+t+" tr:eq("+ii+") td:eq(1)").text(""),$("#"+t+" tr:eq("+ii+") td:eq(1)").append(a+b);var c=[];$("#sel_context :selected").each(function(a,b){c[a]=$(b).text()});var d="";c.length>1?($.each(c,function(a,b){d=d+" "+b}),$("#"+t+" tr:eq("+ii+") td:eq(2)").append("<span class='ctx'>"+c.join(", ")+"</span>"),console.log("sol1")):(d=$("#sel_context :selected").text(),$("#"+t+" tr:eq("+ii+") td:eq(2)").append("<span class='ctx'>"+d+"</span>"),console.log("sol2")),$("#sel_level option:selected").removeAttr("selected"),$("#sel_context > option").prop("selected",!1),$("#i_years").val("")}function genPDF(){var a=new jsPDF("p","pt");a.setProperties({title:"DC Profile: "+$("#pers tr:nth-child(2) td:nth-child(2)").text(),subject:"My IT Profile",author:"AMPM",keywords:"report, js,html",creator:"NANO"});var b="{total_pages_count_string}",c=function(){a.text("DC Profile",180,30),a.setFontSize(9),a.setTextColor(255,165,0),a.text($("#pers tr:nth-child(2) td:nth-child(2)").text(),180,45)},d=1,e=function(c){var e=new Date,f="Page "+d,g=e.toLocaleDateString();"function"==typeof a.putTotalPages&&(f=f+" of "+b),a.text(g,c.settings.margin.left,a.internal.pageSize.height-30),a.text(f,c.settings.margin.left+480,a.internal.pageSize.height-30),d++};style={0:{columnWidth:150,fontStyle:"bold"},1:{columnWidth:350}},style2={0:{columnWidth:150},1:{columnWidth:150},2:{columnWidth:200}};var f=a.autoTableHtmlToJson(document.querySelector("#pers")),g=f.columns,h=f.data;a.autoTable(g,h,{startY:60,theme:"grid",font:"arial",styles:{overflow:"linebreak",fontSize:10},columnStyles:style,drawHeaderRow:function(){return!1},drawRow:function(b,c){a.setFontStyle("bold"),a.setFontSize(10),0===b.index&&(a.setTextColor(255,255,255),a.setFillColor(30,144,255),a.rect(c.settings.margin.left,b.y,c.table.width-15,20,"F"),a.setFillColor(255,50,20),a.autoTableText("Personal Information",c.settings.margin.left+10,b.y+10,{valign:"middle"}),c.cursor.y+=20)},beforePageContent:c});var i=a.autoTableHtmlToJson(document.querySelector("#it1")),j=i.columns,k=i.data;a.autoTable(j,k,{startY:a.autoTableEndPosY()+10,theme:"grid",font:"arial",headerStyles:{halign:"center",valign:"middle",fillColor:0},styles:{overflow:"linebreak",fontSize:9},columnStyles:style2});var l=a.autoTableHtmlToJson(document.querySelector("#it2")),m=l.columns,n=l.data;a.autoTable(m,n,{startY:a.autoTableEndPosY()+10,theme:"grid",font:"arial",margin:{top:60},headerStyles:{halign:"center",valign:"middle",fillColor:0},styles:{overflow:"linebreak",fontSize:9},columnStyles:style2,afterPageContent:e,beforePageContent:c});var o=a.autoTableHtmlToJson(document.querySelector("#db")),p=o.columns,q=o.data;a.autoTable(p,q,{startY:a.autoTableEndPosY()+10,theme:"grid",font:"arial",headerStyles:{halign:"center",valign:"middle",fillColor:0},styles:{overflow:"linebreak",fontSize:9},columnStyles:style2});var r=a.autoTableHtmlToJson(document.querySelector("#sof")),s=r.columns,t=r.data;a.autoTable(s,t,{startY:a.autoTableEndPosY()+10,theme:"grid",font:"arial",headerStyles:{halign:"center",valign:"middle",fillColor:0},styles:{overflow:"linebreak",fontSize:9},columnStyles:style2});var u=a.autoTableHtmlToJson(document.querySelector("#op")),v=u.columns,w=u.data;a.autoTable(v,w,{startY:a.autoTableEndPosY()+10,theme:"grid",font:"arial",headerStyles:{halign:"center",valign:"middle",fillColor:0},styles:{overflow:"linebreak",fontSize:9},columnStyles:style2});var x=a.autoTableHtmlToJson(document.querySelector("#met")),y=x.columns,z=x.data;a.autoTable(y,z,{startY:a.autoTableEndPosY()+100,theme:"grid",font:"arial",margin:{top:60},headerStyles:{halign:"center",valign:"middle",fillColor:0},styles:{overflow:"linebreak",fontSize:9},columnStyles:style2,beforePageContent:c,afterPageContent:e}),"function"==typeof a.putTotalPages&&a.putTotalPages(b);var A=a.output("datauristring");window.open(A,"_blank")}$("#modal_info").on("show.bs.modal",function(a){$("#i_name").val($("#pers tr:nth-child(2) td:nth-child(2)").text()),$("#i_country").val($("#pers tr:nth-child(3) td:nth-child(2)").text()),$("#i_email").val($("#pers tr:nth-child(4) td:nth-child(2)").text()),$("#i_deg").val($("#pers tr:nth-child(5) td:nth-child(2)").text()),$("#i_pos").val($("#pers tr:nth-child(6) td:nth-child(2)").text()),$("#i_pro").val($("#pers tr:nth-child(7) td:nth-child(2)").text())}),$("#modal_info").on("hidden.bs.modal",function(a){$("#i_name").val("")}),$("#it1 tr").each(function(a){a>=1&&$(this).find("td:eq(0)").append('&nbsp; &nbsp; <a href="#" data-toggle="modal" data-target="#modal_tech"><i class="fa fa-edit text-primary"></i></a>')}),$("#it2 tr").each(function(a){a>=1&&$(this).find("td:eq(0)").append('&nbsp; &nbsp; <a href="#" data-toggle="modal" data-target="#modal_tech"><i class="fa fa-edit text-primary"></i></a>')}),$("#db tr").each(function(a){a>=1&&$(this).find("td:eq(0)").append('&nbsp; &nbsp; <a href="#" data-toggle="modal" data-target="#modal_tech"><i class="fa fa-edit text-primary"></i></a>')}),$("#sof tr").each(function(a){a>=1&&$(this).find("td:eq(0)").append('&nbsp; &nbsp; <a href="#" data-toggle="modal" data-target="#modal_tech"><i class="fa fa-edit text-primary"></i></a>')}),$("#op tr").each(function(a){a>=1&&$(this).find("td:eq(0)").append('&nbsp; &nbsp; <a href="#" data-toggle="modal" data-target="#modal_tech"><i class="fa fa-edit text-primary"></i></a>')}),$("#metho tr").each(function(a){a>=1&&$(this).find("td:eq(0)").append('&nbsp; &nbsp; <a href="#" data-toggle="modal" data-target="#modal_tech"><i class="fa fa-edit text-primary"></i></a>')});var ii,t,l;$("table tr td").find("i").click(function(){console.log("row index: "+$(this).parent().parent().parent().index()),console.log("Table id: "+$(this).parent().parent().parent().parent().parent().attr("id")),console.log("Edit - "+$(this).parent().parent().text()),ii=$(this).parent().parent().parent().index(),t=$(this).parent().parent().parent().parent().parent().attr("id"),l="- "+$(this).parent().parent().text(),$("#lbl").text(l)});
